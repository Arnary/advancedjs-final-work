<div id="ratingModalRoot" class="modal__backdrop">
  <div class="modal__window modal__window_rating">
    <img class="svg modal__close-btn" id="rating_close_btn" src="./img/close-btn.svg" alt="X"/>
    <form id="ratingForm">
      <h3 class="modal__rating-title">Rating</h3>
      <div class="modal__rating">
        <span class="modal__rating-value">0.0</span>

        <div class="modal__rating-star">
          <input type="radio" id="star1" name="rating" value="1" required>
          <label for="star1">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="19" viewBox="0 0 20 19" fill="none">
              <path
                d="M9.04894 0.927052C9.3483 0.00574112 10.6517 0.00573993 10.9511 0.927051L12.4697 5.60081C12.6035 6.01284 12.9875 6.2918 13.4207 6.2918H18.335C19.3037 6.2918 19.7065 7.53141 18.9228 8.10081L14.947 10.9894C14.5966 11.244 14.4499 11.6954 14.5838 12.1074L16.1024 16.7812C16.4017 17.7025 15.3472 18.4686 14.5635 17.8992L10.5878 15.0106C10.2373 14.756 9.7627 14.756 9.41221 15.0106L5.43648 17.8992C4.65276 18.4686 3.59828 17.7025 3.89763 16.7812L5.41623 12.1074C5.55011 11.6954 5.40345 11.244 5.05296 10.9894L1.07722 8.10081C0.293507 7.53141 0.696283 6.2918 1.66501 6.2918H6.57929C7.01252 6.2918 7.39647 6.01284 7.53035 5.60081L9.04894 0.927052Z"
                fill="#F4F4F4" fill-opacity="0.2"/>
            </svg>
          </label>
        </div>
        <div class="modal__rating-star">
          <input type="radio" id="star2" name="rating" value="2">
          <label for="star2">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="19" viewBox="0 0 20 19" fill="none">
              <path
                d="M9.04894 0.927052C9.3483 0.00574112 10.6517 0.00573993 10.9511 0.927051L12.4697 5.60081C12.6035 6.01284 12.9875 6.2918 13.4207 6.2918H18.335C19.3037 6.2918 19.7065 7.53141 18.9228 8.10081L14.947 10.9894C14.5966 11.244 14.4499 11.6954 14.5838 12.1074L16.1024 16.7812C16.4017 17.7025 15.3472 18.4686 14.5635 17.8992L10.5878 15.0106C10.2373 14.756 9.7627 14.756 9.41221 15.0106L5.43648 17.8992C4.65276 18.4686 3.59828 17.7025 3.89763 16.7812L5.41623 12.1074C5.55011 11.6954 5.40345 11.244 5.05296 10.9894L1.07722 8.10081C0.293507 7.53141 0.696283 6.2918 1.66501 6.2918H6.57929C7.01252 6.2918 7.39647 6.01284 7.53035 5.60081L9.04894 0.927052Z"
                fill="#F4F4F4" fill-opacity="0.2"/>
            </svg>
          </label>
        </div>
        <div class="modal__rating-star">
          <input type="radio" id="star3" name="rating" value="3">
          <label for="star3">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="19" viewBox="0 0 20 19" fill="none">
              <path
                d="M9.04894 0.927052C9.3483 0.00574112 10.6517 0.00573993 10.9511 0.927051L12.4697 5.60081C12.6035 6.01284 12.9875 6.2918 13.4207 6.2918H18.335C19.3037 6.2918 19.7065 7.53141 18.9228 8.10081L14.947 10.9894C14.5966 11.244 14.4499 11.6954 14.5838 12.1074L16.1024 16.7812C16.4017 17.7025 15.3472 18.4686 14.5635 17.8992L10.5878 15.0106C10.2373 14.756 9.7627 14.756 9.41221 15.0106L5.43648 17.8992C4.65276 18.4686 3.59828 17.7025 3.89763 16.7812L5.41623 12.1074C5.55011 11.6954 5.40345 11.244 5.05296 10.9894L1.07722 8.10081C0.293507 7.53141 0.696283 6.2918 1.66501 6.2918H6.57929C7.01252 6.2918 7.39647 6.01284 7.53035 5.60081L9.04894 0.927052Z"
                fill="#F4F4F4" fill-opacity="0.2"/>
            </svg>
          </label>
        </div>
        <div class="modal__rating-star">
          <input type="radio" id="star4" name="rating" value="4">
          <label for="star4">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="19" viewBox="0 0 20 19" fill="none">
              <path
                d="M9.04894 0.927052C9.3483 0.00574112 10.6517 0.00573993 10.9511 0.927051L12.4697 5.60081C12.6035 6.01284 12.9875 6.2918 13.4207 6.2918H18.335C19.3037 6.2918 19.7065 7.53141 18.9228 8.10081L14.947 10.9894C14.5966 11.244 14.4499 11.6954 14.5838 12.1074L16.1024 16.7812C16.4017 17.7025 15.3472 18.4686 14.5635 17.8992L10.5878 15.0106C10.2373 14.756 9.7627 14.756 9.41221 15.0106L5.43648 17.8992C4.65276 18.4686 3.59828 17.7025 3.89763 16.7812L5.41623 12.1074C5.55011 11.6954 5.40345 11.244 5.05296 10.9894L1.07722 8.10081C0.293507 7.53141 0.696283 6.2918 1.66501 6.2918H6.57929C7.01252 6.2918 7.39647 6.01284 7.53035 5.60081L9.04894 0.927052Z"
                fill="#F4F4F4" fill-opacity="0.2"/>
            </svg>
          </label>
        </div>
        <div class="modal__rating-star">
          <input type="radio" id="star5" name="rating" value="5">
          <label for="star5">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="19" viewBox="0 0 20 19" fill="none">
              <path
                d="M9.04894 0.927052C9.3483 0.00574112 10.6517 0.00573993 10.9511 0.927051L12.4697 5.60081C12.6035 6.01284 12.9875 6.2918 13.4207 6.2918H18.335C19.3037 6.2918 19.7065 7.53141 18.9228 8.10081L14.947 10.9894C14.5966 11.244 14.4499 11.6954 14.5838 12.1074L16.1024 16.7812C16.4017 17.7025 15.3472 18.4686 14.5635 17.8992L10.5878 15.0106C10.2373 14.756 9.7627 14.756 9.41221 15.0106L5.43648 17.8992C4.65276 18.4686 3.59828 17.7025 3.89763 16.7812L5.41623 12.1074C5.55011 11.6954 5.40345 11.244 5.05296 10.9894L1.07722 8.10081C0.293507 7.53141 0.696283 6.2918 1.66501 6.2918H6.57929C7.01252 6.2918 7.39647 6.01284 7.53035 5.60081L9.04894 0.927052Z"
                fill="#F4F4F4" fill-opacity="0.2"/>
            </svg>
          </label>
        </div>
      </div>

      <input type="email" id="email" name="email" placeholder="Email" class="modal__rating-field"
             pattern="^\w+(\.\w+)?@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$" required>
      <textarea id="comment" name="comment" placeholder="Your comment" class="modal__rating-field textarea"
                required></textarea>

      <button type="submit" class="modal__rating-submit">Send</button>
    </form>
  </div>
</div>

<script type="module">
  import {ModalWindow} from './js/utils/modalWindow';
  import {axiosWrapper} from './js/utils/axiosWrapper.js';

  const modalRootEl = document.getElementById('modalRoot');
  const modal = new ModalWindow(modalRootEl, {
    closeButtonSelector: '#main_close_btn',
  });

  const ratingModalRootEl = document.getElementById('ratingModalRoot');
  const ratingModal = new ModalWindow(ratingModalRootEl, {
    closeButtonSelector: '#rating_close_btn',
    onCloseCallback: () => {
      initializeModal();
    }
  });

  const initializeModal = () => {
    const modalHtmlContents = '<div>Modal opened</div>';
    modal.show(modalHtmlContents);
    document.getElementById('give_rating_btn').addEventListener('click', openRatingModal);
  };

  const openRatingModal = () => {
    modal.close();
    ratingModal.show();
    document.getElementById('ratingForm').addEventListener('submit', submitRating);
  };

  const submitRating = async (event) => {
    event.preventDefault();

    const formData = new FormData(event.target);
    const rating = formData.get('rating');
    const email = formData.get('email');
    const comment = formData.get('comment');

    const axios = new axiosWrapper();

    try {
      const data = await axios.post('/some-bknd-url', { rating, email, comment });

      if (data.success) {
        ratingModal.close();
        initializeModal();
      } else {
        alert(`Error: ${data.message}`);
      }
    } catch (error) {
      alert(`Error: ${axios.describeError(error)}`);
    }
  };

  document.getElementById('rating_close_btn').addEventListener('click', () => {
    ratingModal.close();
  });
</script>